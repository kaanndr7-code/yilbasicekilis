
<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>ğŸ„ YÄ±lbaÅŸÄ± Ã‡ekiliÅŸi SimÃ¼latÃ¶rÃ¼</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
* {
  box-sizing: border-box;
  font-family: "Poppins", sans-serif;
}
body {
  margin: 0;
  padding: 0;
  background: linear-gradient(180deg, #020617 0%, #0f172a 100%);
  color: #f9fafb;
  overflow-x: hidden;
}

.container {
  margin: 32px auto;
  max-width: 1000px;
  width: 90%;
  background: rgba(15, 23, 42, 0.75);
  border-radius: 18px;
  padding: 32px;
  border: 1px solid rgba(148, 163, 184, 0.35);
  box-shadow: 0 20px 40px rgba(0,0,0,0.5);
  backdrop-filter: blur(12px);
}

h1 {
  text-align: center;
  font-size: 34px;
  font-weight: 700;
}

h1 span {
  color: #facc15;
}

.subtitle {
  text-align: center;
  font-size: 15px;
  color: #d1d5db;
  margin-bottom: 24px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 24px;
  margin-bottom: 20px;
}

label {
  display: block;
  font-size: 14px;
  margin-bottom: 6px;
}

textarea, input {
  width: 100%;
  border-radius: 12px;
  padding: 12px;
  font-size: 15px;
  background: rgba(2, 6, 23, 0.75);
  color: #f9fafb;
  border: 1px solid #334155;
}

textarea {
  min-height: 160px;
  resize: vertical;
}

.hint {
  font-size: 12px;
  color: #9ca3af;
  margin-top: 4px;
}

button {
  width: 260px;
  padding: 14px;
  border: none;
  border-radius: 999px;
  font-size: 18px;
  cursor: pointer;
  background: linear-gradient(135deg, #f97316, #facc15);
  color: #111827;
  font-weight: 700;
  box-shadow: 0 10px 30px rgba(250, 204, 21, 0.35);
  transition: .1s;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 16px 40px rgba(250,204,21,0.45);
}

.error, .ok {
  margin-top: 15px;
  padding: 12px;
  border-radius: 12px;
  font-size: 14px;
  border: 1px solid;
}

.error {
  background: rgba(153, 27, 27, 0.75);
  border-color: #b91c1c;
  color: #fecaca;
}

.ok {
  background: rgba(22, 101, 52, 0.6);
  border-color: #16a34a;
  color: #bbf7d0;
}

.qr-grid {
  margin-top: 25px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 18px;
}

.qr-card {
  background: rgba(15,23,42,0.85);
  border: 1px solid rgba(148,163,184,0.25);
  border-radius: 14px;
  padding: 16px;
  text-align: center;
}

.qr-card h3 {
  color: #facc15;
  font-size: 18px;
  margin-bottom: 4px;
}

.qr-card p {
  font-size: 12px;
  color: #9ca3af;
}

.qr-card img {
  margin-top: 8px;
  width: 180px;
  height: 180px;
  background: black;
  border-radius: 10px;
}

.admin-line {
  margin-top: 6px;
  font-size: 11px;
  color: #6b7280;
}

/* Kar Efekti */
.snowflake {
  position: fixed;
  top: -10px;
  color: white;
  opacity: 0.8;
  font-size: 18px;
  animation-name: fall;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
  pointer-events: none;
}
@keyframes fall {
  0% { transform: translateY(-10px); opacity: 1; }
  100% { transform: translateY(100vh); opacity: 0; }
}

@media (max-width: 600px) {
  button { width: 100%; }
}
</style>
</head>
<body>

<!-- Kar Efektleri -->
<script>
for (let i = 0; i < 60; i++) {
  let snow = document.createElement("div");
  snow.className = "snowflake";
  snow.innerHTML = "â„";
  snow.style.left = Math.random() * 100 + "%";
  snow.style.fontSize = (Math.random() * 14 + 10) + "px";
  snow.style.animationDuration = (Math.random() * 7 + 5) + "s";
  snow.style.opacity = Math.random();
  document.body.appendChild(snow);
}
</script>

<!-- MÃ¼zik -->
<audio id="bgMusic" autoplay loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>
<script>
document.addEventListener("click", () => {
  const music = document.getElementById("bgMusic");
  music.volume = 0.35;
  music.play().catch(()=>{});
});
</script>

<div class="container">
  <h1>ğŸ YÄ±lbaÅŸÄ± Ã‡ekiliÅŸi <span>SimÃ¼latÃ¶rÃ¼</span></h1>

  <div class="subtitle">
    Ã–zel kural: <b>Ã–zel kiÅŸi hem hediye vereceÄŸi hem alacaÄŸÄ± kiÅŸi iÃ§in sadece tanÄ±dÄ±k listesini kullanÄ±r.</b><br>
    SonuÃ§lar QR ile fotoÄŸraf ÅŸeklinde aÃ§Ä±lÄ±r.
  </div>

  <div class="grid">
    <div>
      <label for="namesInput">TÃ¼m KatÄ±lÄ±mcÄ±lar (her satÄ±ra bir isim)</label>
      <textarea id="namesInput" placeholder="Ã–rn:
Kaan
AyÅŸe
Mehmet
Zeynep"></textarea>
      <div class="hint">Ä°simler birebir aynÄ± olmalÄ±.</div>
    </div>

    <div>
      <label for="specialName">Ã–zel KiÅŸi</label>
      <input id="specialName" placeholder="Ã–rn: Kaan">

      <label for="knownListInput" style="margin-top:10px;">Bu kiÅŸinin tanÄ±dÄ±klarÄ±</label>
      <textarea id="knownListInput" placeholder="Ã–rn:
AyÅŸe
Mehmet"></textarea>
      <div class="hint">Ã–zel kiÅŸinin adÄ± buraya yazÄ±lmaz.</div>
    </div>
  </div>

  <div style="text-align:center; margin-top:10px;">
    <button onclick="runDraw()">ğŸ² Ã‡ekiliÅŸi Yap & QR'larÄ± OluÅŸtur</button>
  </div>

  <div id="message"></div>

  <div id="resultArea" style="display:none;">
    <h2 style="margin-top:28px; text-align:center;">ğŸ“± KiÅŸiye Ã–zel QR KartlarÄ±</h2>
    <p class="hint" style="text-align:center;">Her QR kiÅŸiye Ã¶zel sonuÃ§ sayfasÄ±nÄ± aÃ§ar.</p>
    <div class="qr-grid" id="qrGrid"></div>
  </div>
</div>

<script>
function shuffle(a){
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// Ã–zel kurallÄ± eÅŸleÅŸtirme
function generateAssignments(participants, specialName, allowedList) {
  const n = participants.length;
  const specialIndex = participants.findIndex(
    p => p.toLowerCase() === specialName.toLowerCase()
  );
  if (specialIndex === -1) return null;

  const allowedLower = allowedList.map(x => x.toLowerCase());
  const maxTries = 8000;

  attemptLoop:
  for (let attempt = 0; attempt < maxTries; attempt++) {
    const receivers = shuffle([...participants]);

    // 1) Kimse kendine Ã§Ä±kmasÄ±n
    for (let i = 0; i < n; i++) {
      if (participants[i].toLowerCase() === receivers[i].toLowerCase()) {
        continue attemptLoop;
      }
    }

    // 2) Ã–zel kiÅŸinin vereceÄŸi kiÅŸi tanÄ±dÄ±klardan olsun
    const recForSpecial = receivers[specialIndex];
    if (!allowedLower.includes(recForSpecial.toLowerCase())) {
      continue;
    }

    // 3) Ã–zel kiÅŸiye hediye veren kiÅŸi de tanÄ±dÄ±klardan olsun
    const giverIndex = receivers.findIndex(
      r => r.toLowerCase() === specialName.toLowerCase()
    );
    if (giverIndex === -1) continue attemptLoop;

    const giverName = participants[giverIndex];
    if (!allowedLower.includes(giverName.toLowerCase())) {
      continue;
    }

    return participants.map((giver, i) => ({
      giver: giver,
      receiver: receivers[i]
    }));
  }

  return null;
}

function runDraw(){
  const namesRaw   = document.getElementById("namesInput").value;
  const specialRaw = document.getElementById("specialName").value.trim();
  const knownRaw   = document.getElementById("knownListInput").value;

  const msg        = document.getElementById("message");
  const qrGrid     = document.getElementById("qrGrid");
  const resultArea = document.getElementById("resultArea");

  msg.innerHTML = "";
  qrGrid.innerHTML = "";
  resultArea.style.display = "none";

  let participants = namesRaw
    .split("\n").map(x => x.trim()).filter(Boolean);

  if (participants.length < 2) {
    msg.innerHTML = '<div class="error">En az 2 kiÅŸi gerekli.</div>';
    return;
  }

  const lowerNames = participants.map(p => p.toLowerCase());
  if (new Set(lowerNames).size !== participants.length) {
    msg.innerHTML = '<div class="error">AynÄ± isim iki kez girilmiÅŸ.</div>';
    return;
  }

  if (!specialRaw) {
    msg.innerHTML = '<div class="error">Ã–zel kiÅŸiyi yazmalÄ±sÄ±n.</div>';
    return;
  }

  if (!participants.some(p => p.toLowerCase() === specialRaw.toLowerCase())) {
    msg.innerHTML = '<div class="error">Ã–zel kiÅŸi listede yok.</div>';
    return;
  }

  let knownList = knownRaw
    .split("\n").map(x => x.trim()).filter(Boolean);

  if (knownList.length === 0) {
    msg.innerHTML = '<div class="error">TanÄ±dÄ±k listesi boÅŸ olamaz.</div>';
    return;
  }

  knownList = knownList.filter(
    name => name.toLowerCase() !== specialRaw.toLowerCase()
  );

  const validKnown = knownList.filter(kn =>
    participants.some(p => p.toLowerCase() === kn.toLowerCase())
  );

  const assignments = generateAssignments(participants, specialRaw, validKnown);

  if (!assignments) {
    msg.innerHTML = '<div class="error">Uygun Ã§ekiliÅŸ bulunamadÄ±. TanÄ±dÄ±k listesini geniÅŸlet.</div>';
    return;
  }

  msg.innerHTML = '<div class="ok">Ã‡ekiliÅŸ tamam! QR kartlarÄ± aÅŸaÄŸÄ±da.</div>';

  // SENÄ°N GITHUB PAGES URL'Ä°N:
  const baseUrl = "https://kaanndr7-code.github.io/yilbasicekilis/";

  assignments.forEach(row => {
    const giver    = row.giver;
    const receiver = row.receiver;

    const resultUrl =
      baseUrl + "sonuc.html?ad=" +
      encodeURIComponent(giver) +
      "&cikti=" +
      encodeURIComponent(receiver);

    const qrURL =
      "https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=" +
      encodeURIComponent(resultUrl);

    const card = document.createElement("div");
    card.className = "qr-card";
    card.innerHTML = `
      <h3>${giver}</h3>
      <p>Bu QR sadece <b>${giver}</b> iÃ§in.</p>
      <img src="${qrURL}" alt="QR - ${giver}">
      <div class="admin-line">(Admin: ${giver} â†’ ${receiver})</div>
    `;
    qrGrid.appendChild(card);
  });

  resultArea.style.display = "block";
}
</script>

</body>
</html>
